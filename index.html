<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MÄ°T | GÃœVENLÄ° PERSONEL UYGULAMASI</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --mit-primary: #003087;
      --mit-accent: #0055b3;
      --border: #b0c4de;
      --danger: #8b0000;
      --success: #006400;
      --bg-main: #f4f6f9;
      --panel: #ffffff;
      --shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    body { background: var(--bg-main); color: #003087; font-family: 'Roboto', sans-serif; margin: 0; min-height: 100vh; transition: all 0.4s ease; }
    body.dark { --bg-main: #0d1117; --panel: #161b22; --border: #30363d; color: #c9d1d9; }
    body.dark .profil-kart, body.dark .content, body.dark .login-container { background: #161b22; border-color: #30363d; }
    body.dark input, body.dark textarea, body.dark select { background: #0d1117; color: #c9d1d9; border-color: #30363d; }
    body.dark .sidebar { background: #010409; }
    body.dark .header { background: #010409; }
    .app-container { display: flex; min-height: 100vh; }
    .sidebar { width: 260px; background: var(--mit-primary); color: white; padding: 1.5rem 1rem; position: fixed; height: 100%; overflow-y: auto; display: none; z-index: 100; transition: all 0.3s; }
    body.panel-active .sidebar { display: block; }
    .sidebar button { width: 100%; padding: 1rem 1.2rem; margin: 0.5rem 0; color: white; background: rgba(255,255,255,0.08); border: none; border-radius: 6px; text-align: left; font-size: 1rem; cursor: pointer; transition: all 0.2s; }
    .sidebar button:hover { background: rgba(255,255,255,0.18); }
    .sidebar button.active { background: rgba(255,255,255,0.3); font-weight: 600; }
    .main-area { flex: 1; margin-left: 0; transition: margin-left 0.4s; padding-top: 80px; }
    body.panel-active .main-area { margin-left: 260px; }
    .header { background: var(--mit-primary); color: white; padding: 1.2rem 2.5rem; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; right: 0; z-index: 99; }
    .theme-toggle { width: 48px; height: 48px; background: rgba(255,255,255,0.2); border: none; border-radius: 50%; color: white; font-size: 1.3rem; cursor: pointer; }
    .content { padding: 2.5rem; display: none; background: var(--panel); border-radius: 8px; margin: 1.5rem; box-shadow: var(--shadow); }
    .content.active { display: block; }
    .login-container { max-width: 540px; margin: 15vh auto; background: white; padding: 4rem 3.5rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); text-align: center; }
    input, textarea, select { width: 100%; padding: 0.9rem 1.2rem; margin: 0.8rem 0; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem; }
    button.primary { background: var(--mit-primary); color: white; border: none; padding: 1.2rem 2rem; border-radius: 4px; cursor: pointer; font-weight: 500; transition: background 0.3s; font-size: 1.2rem; width: 100%; }
    button.primary:hover { background: var(--mit-accent); }
    .profil-kart { display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem; background: linear-gradient(135deg, #f8f9fa, #e9f0ff); border: 2px solid var(--mit-primary); border-radius: 12px; padding: 2.5rem; margin-bottom: 3rem; box-shadow: 0 8px 30px rgba(0,48,135,0.15); }
    .arsiv-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.8rem; margin: 2.5rem 0; }
    .kutu { background: linear-gradient(135deg, #0d47a1, #1976d2); color: white; border: 2px solid #1565c0; border-radius: 12px; padding: 2rem 1.5rem; cursor: pointer; transition: all 0.35s ease; box-shadow: 0 6px 18px rgba(21,101,192,0.3); }
    .kutu:hover { transform: translateY(-8px); box-shadow: 0 14px 32px rgba(21,101,192,0.5); background: linear-gradient(135deg, #1565c0, #1e88e5); }
    .alt-kutu { background: linear-gradient(135deg, #1976d2, #2196f3); color: white; border: 2px solid #42a5f5; margin: 1rem 0; padding: 1.5rem; border-radius: 10px; }
    .alt-kutu:hover { background: linear-gradient(135deg, #2196f3, #42a5f5); }
    .admin-section { margin: 2.5rem 0; padding-top: 1.5rem; border-top: 1px solid var(--border); }
    .success-msg { color: var(--success); text-align: center; margin-top: 1rem; display: none; font-weight: bold; }
  </style>
</head>
<body>
<div class="app-container">
  <nav class="sidebar" id="sidebar">
    <h3>PERSONEL MENÃœSÃœ</h3>
    <button onclick="showSection('dashboard')" class="active">Ana Panel</button>
    <button onclick="showSection('mit-arsivi')">MÄ°T'in ArÅŸivi</button>
    <button onclick="showSection('rapor')">Rapor Yaz</button>
    <button onclick="showSection('duyurular')">Personel Bilgilendirme</button>
    <button id="admin-yonetim-btn" onclick="showSection('yonetici-paneli')" style="display:none;">YÃ¶netici Paneli</button>
    <button onclick="cikisYap()">Ã‡Ä±kÄ±ÅŸ Yap</button>
  </nav>
  <div class="main-area">
    <header class="header">
      <div>MÄ°LLÄ° Ä°STÄ°HBARAT TEÅžKÄ°LATI</div>
      <div style="display:flex; align-items:center; gap:1.5rem;">
        <span>TERMINAL â€¢ <span id="current-time">00:00</span> â€¢ SEVÄ°YE 4</span>
        <button class="theme-toggle" id="theme-toggle-btn"><i class="fas fa-moon"></i></button>
      </div>
    </header>
    <div class="login-container" id="giris">
      <h1>PERSONEL GÄ°RÄ°ÅžÄ°</h1>
      <p style="color:#555; margin:2rem 0;">GÄ°ZLÄ°LÄ°K DERECESÄ°: Ã‡OK GÄ°ZLÄ°</p>
      <input type="password" id="access-password" placeholder="PERSONEL KODU" autocomplete="off" style="letter-spacing: 2px; text-align:center; font-size:1.8rem;">
      <button class="primary" id="giris-buton">GÄ°RÄ°Åž YAP</button>
      <p id="wrong-pass" style="color:var(--danger); display:none; margin-top:1.5rem; font-weight:bold;"></p>
    </div>
    <div id="panel" style="display:none;">
      <div id="dashboard" class="content active">
        <h2>ANA PANEL</h2>
        <div class="profil-kart">
          <div>
            <h3 id="giris-yapan-isim">---</h3>
            <p id="giris-yapan-birim">Birim: ---</p>
            <p id="giris-yapan-rutbe">RÃ¼tbe: ---</p>
          </div>
          <div>
            <p><strong>Aktif GÃ¶rev:</strong></p>
            <p style="color:var(--success); font-weight:bold; font-size:1.4rem;">BÃ¶lge Takibi ve Analizi (Aktif)</p>
            <p style="font-style:italic; color:#555; margin-top:1.5rem;">"GÃ¶rÃ¼lmeyeni gÃ¶rÃ¼r, duyulmayanÄ± duyarÄ±z"</p>
          </div>
        </div>
      </div>
      <div id="mit-arsivi" class="content">
        <h2>MÄ°T'Ä°N ARÅžÄ°VÄ°</h2>
        <p style="color:#555; margin-bottom:1.5rem;">KiÅŸi ve organizasyonlara ait istihbarat kayÄ±tlarÄ±, suÃ§/hata dosyalarÄ±</p>
        <div class="arsiv-grid" id="arsiv-grid"></div>
        <div id="arsiv-detay" style="display:none;"></div>
      </div>
      <div id="rapor" class="content">
        <h2>RAPOR YAZ</h2>
        <select id="status"><option>DURUM SEÃ‡</option><option>Aktif</option><option>TamamlandÄ±</option><option>Acil</option></select>
        <div style="display:flex; flex-wrap:wrap; gap:0.8rem; margin:1.5rem 0;">
          <button class="primary" onclick="sablonDoldur('kisi')">KiÅŸi Takip</button>
          <button class="primary" onclick="sablonDoldur('operasyon')">Operasyon</button>
          <button class="primary" onclick="sablonDoldur('acil')">Acil Durum</button>
        </div>
        <textarea id="report-text" rows="10" placeholder="Rapor iÃ§eriÄŸi..."></textarea>
        <button class="primary" onclick="gonderRapor()">RAPORU MERKEZE GÃ–NDER</button>
        <p id="raporSuccess" class="success-msg">âœ“ Rapor Discord kanalÄ±na iletildi</p>
      </div>
      <div id="duyurular" class="content">
        <h2>Personel Bilgilendirme</h2>
        <p>Duyurular Discord sunucusunda paylaÅŸÄ±lmaktadÄ±r.</p>
        <a href="https://discord.gg/a6XbjtkR" target="_blank" class="primary" style="display:block; text-align:center; margin:2rem auto; max-width:300px;">
          <i class="fab fa-discord"></i> DISCORD'A GÄ°T
        </a>
      </div>
      <div id="yonetici-paneli" class="content">
        <h2>YÃ–NETÄ°CÄ° PANELÄ°</h2>
        <!-- Yeni: Duyuru GÃ¶nderme (sadece admin gÃ¶rÃ¼r) -->
        <div class="admin-section">
          <h3>Duyuru GÃ¶nder (TÃ¼m Personele)</h3>
          <input id="duyuru-baslik" placeholder="Duyuru BaÅŸlÄ±ÄŸÄ±">
          <textarea id="duyuru-icerik" rows="4" placeholder="Duyuru metni..."></textarea>
          <button class="primary" onclick="gonderDuyuru()">DUYURUYU GÃ–NDER</button>
          <p id="duyuruSuccess" class="success-msg">âœ“ Duyuru Discord'a iletildi</p>
        </div>
        <div class="admin-section">
          <h3>Yeni Kategori Ekle</h3>
          <input id="kategori-baslik" placeholder="Kategori AdÄ± (Ã¶rn: Emniyet Personeli)">
          <textarea id="kategori-aciklama" placeholder="KÄ±sa aÃ§Ä±klama"></textarea>
          <button class="primary" onclick="kategoriEkle()">KATEGORÄ° EKLE</button>
          <p id="kategoriSuccess" class="success-msg">âœ“ Kategori eklendi</p>
        </div>
        <div class="admin-section">
          <h3>Kategori KaldÄ±r</h3>
          <select id="kaldir-kategori"></select>
          <button class="primary" style="background:var(--danger); width:100%; margin-top:0.8rem;" onclick="kategoriKaldir()">KATEGORÄ°YÄ° KALDIR</button>
          <p id="kaldirSuccess" class="success-msg">âœ“ Kategori kaldÄ±rÄ±ldÄ±</p>
        </div>
        <div class="admin-section">
          <h3>Alt Konu / Rapor Ekle</h3>
          <select id="alt-ekle-kategori"></select>
          <input id="alt-baslik" placeholder="Alt konu / Rapor baÅŸlÄ±ÄŸÄ±">
          <textarea id="alt-detay" placeholder="Detay (suÃ§, hata, istihbarat kaydÄ± vs.)"></textarea>
          <input id="alt-tarih" placeholder="Tarih (Ã¶rn: 15 Ocak 2026)" value="15 Ocak 2026">
          <button class="primary" onclick="altKonuEkle()">ALT KONU / RAPOR EKLE</button>
          <p id="altSuccess" class="success-msg">âœ“ Eklendi</p>
        </div>
        <div class="admin-section">
          <h3>Alt Konu / Rapor KaldÄ±r</h3>
          <select id="alt-kaldir-kategori" onchange="updateAltKaldirSelect()"></select>
          <select id="alt-kaldir-item"></select>
          <button class="primary" style="background:var(--danger); width:100%; margin-top:0.8rem;" onclick="altKonuKaldir()">SEÃ‡Ä°LÄ° RAPORU KALDIR</button>
          <p id="altKaldirSuccess" class="success-msg" style="display:none;">âœ“ Rapor kaldÄ±rÄ±ldÄ±</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PERSONEL LÄ°STESÄ° - SON HALÄ°
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PERSONELLER = [
  { sifre: "MIT2026CCCC1965", kodadi: "KORKUT",     rutbe: "MÃ¼steÅŸar/BaÅŸkan",               seviye: 5, isAdmin: true  },
  { sifre: "MIT2026CCCC1453", kodadi: "BEYAZIT",    rutbe: "YardÄ±mcÄ± BaÅŸkan",                seviye: 5, isAdmin: false },
  { sifre: "MIT2026CCCC0033", kodadi: "ANKA",       rutbe: "JÄ°TEM BaÅŸkanÄ±",                  seviye: 5, isAdmin: true  },
  { sifre: "MIT2026CCCC0044", kodadi: "NEO",        rutbe: "BaÅŸ Uzman",                      seviye: 4, isAdmin: false },
  { sifre: "MIT2026BBBB1155", kodadi: "ZÃœMRÃœTT",    rutbe: "Ä°stihbarat UzmanÄ±",              seviye: 4, isAdmin: false },
  { sifre: "MIT2026BBBB2266", kodadi: "HAZAL",      rutbe: "Ã–zel Operasyonlar Tim Personeli", seviye: 4, isAdmin: false },
  { sifre: "MIT2026BBBB3377", kodadi: "SARI",       rutbe: "Yer AltÄ± Personeli",             seviye: 3, isAdmin: false },
  { sifre: "EGM2026EEEE0155", kodadi: "BOZOK",      rutbe: "Emniyet Ä°stihbarat Operasyonel Teknik Bilgi SaÄŸlayÄ±cÄ±sÄ±", seviye: 3, isAdmin: false },
  { sifre: "EGM2026EEEE1122", kodadi: "YILKIRAN",   rutbe: "Emniyet Operasyon Åžefi",         seviye: 4, isAdmin: false },
  { sifre: "MIT2026EEEE0212", kodadi: "BEYAZ",      rutbe: "Koruma ve Emniyet Memuru: Kritik personelin ve tesislerin gÃ¼venliÄŸini saÄŸlar", seviye: 3, isAdmin: false },
  { sifre: "MIT2026EEEE3434", kodadi: "TATAR",      rutbe: "Ã–zel Harekat BaÄŸlÄ± Operasyonal Destek Koordine Amiri", seviye: 4, isAdmin: false }
];

let currentUser = null;
let isAdmin = false;
const STORAGE_KEY = 'mit_arsiv_kategoriler';
let arsivKategoriler = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
  { id: '1', baslik: 'Emniyet Personeli', aciklama: 'Emniyet teÅŸkilatÄ±ndaki ÅŸÃ¼pheli hareketler ve baÄŸlantÄ±lar', icerik: [] },
  { id: '2', baslik: 'YargÄ± MensuplarÄ±', aciklama: 'HÃ¢kim, savcÄ± ve adli personel dosyalarÄ±', icerik: [] }
];
// Discord Webhook URL'leri
const WEBHOOK_RAPOR = "https://discord.com/api/webhooks/1457829355358261615/-uOZYjIN03dbE01uasvp0QK2bxujojEShfhrQX-bEAPFwpCebn9TdJYMgBipfMFf-3nX";
const WEBHOOK_DUYURU = "https://discord.com/api/webhooks/1457829359250440326/NVcJMDNV4gZgYrtiB0JtxnfflbBJFJwIEV3RXNUbE37Glq94h8dV6wEoREySBJ4gsfI_";

function girisYap() {
  const sifre = document.getElementById('access-password').value.trim();
  const errorP = document.getElementById('wrong-pass');
  errorP.style.display = 'none';
  if (!sifre) {
    errorP.textContent = 'Ã— PERSONEL KODU GÄ°RMEDÄ°NÄ°Z Ã—';
    errorP.style.display = 'block';
    return;
  }
  const user = PERSONELLER.find(p => p.sifre === sifre);
  if (!user) {
    errorP.textContent = 'Ã— GEÃ‡ERSÄ°Z PERSONEL KODU â€“ MERKEZE BÄ°LDÄ°RÄ°LDÄ° Ã—';
    errorP.style.display = 'block';
    document.getElementById('access-password').value = '';
    return;
  }
  currentUser = user;
  
  // YÃ¶netici eriÅŸimi SADECE KORKUT ve ANKA iÃ§in
  isAdmin = (user.sifre === "MIT2026CCCC1965" || user.sifre === "MIT2026CCCC0033");

  // Birim otomatik belirleme
  let birim = "Milli Ä°stihbarat TeÅŸkilatÄ±";
  if (user.sifre.includes('EEEE')) {
    birim = "Emniyet TeÅŸkilatÄ±";
  }

  document.getElementById('giris-yapan-isim').textContent = user.kodadi;
  document.getElementById('giris-yapan-birim').textContent = `Birim: ${birim}`;
  document.getElementById('giris-yapan-rutbe').textContent = `RÃ¼tbe: ${user.rutbe}`;

  document.getElementById('admin-yonetim-btn').style.display = isAdmin ? 'block' : 'none';

  document.getElementById('giris').style.display = 'none';
  document.getElementById('panel').style.display = 'block';
  document.body.classList.add('panel-active');
  showSection('dashboard');
  renderArsiv();
}
// RAPOR GÃ–NDERME (rol etiketli)
async function gonderRapor() {
  const text = document.getElementById('report-text').value.trim();
  if (!text) return alert('Rapor iÃ§eriÄŸi boÅŸ olamaz!');

  let birim = "Milli Ä°stihbarat TeÅŸkilatÄ±";
  if (currentUser.sifre.includes('EEEE')) {
    birim = "Emniyet TeÅŸkilatÄ±";
  }

  const payload = {
    content: "<@&1452782503759843482>",  // Rapor rolÃ¼nÃ¼ etiketle
    embeds: [{
      title: `ðŸ“¤ Yeni Rapor - ${currentUser.kodadi} (${currentUser.rutbe}) â€¢ ${birim}`,
      description: "```" + text.substring(0, 2000) + "```",
      color: 3447003, // mavi
      timestamp: new Date().toISOString(),
      footer: { text: "MÄ°T GÃ¼venli Terminal â€¢ " + new Date().toLocaleString('tr-TR') }
    }]
  };

  try {
    const res = await fetch(WEBHOOK_RAPOR, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (res.ok) {
      document.getElementById('raporSuccess').style.display = 'block';
      setTimeout(() => {
        document.getElementById('raporSuccess').style.display = 'none';
        document.getElementById('report-text').value = '';
      }, 3000);
    } else {
      alert('Webhook hatasÄ±: ' + res.status);
    }
  } catch (err) {
    alert('GÃ¶nderme hatasÄ±: ' + err.message);
  }
}
async function gonderDuyuru() {
  if (!isAdmin) return alert('Sadece yÃ¶neticiler duyuru gÃ¶nderebilir!');
  const baslik = document.getElementById('duyuru-baslik').value.trim();
  const icerik = document.getElementById('duyuru-icerik').value.trim();
  if (!baslik || !icerik) return alert('BaÅŸlÄ±k ve iÃ§erik zorunlu!');
  const payload = {
    embeds: [{
      title: `ðŸ”” ${baslik}`,
      description: icerik,
      color: 15844367,
      timestamp: new Date().toISOString(),
      author: { name: `GÃ¶nderen: ${currentUser.kodadi}` },
      footer: { text: "MÄ°T Personel Duyurusu â€¢ " + new Date().toLocaleString('tr-TR') }
    }]
  };
  try {
    const res = await fetch(WEBHOOK_DUYURU, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (res.ok) {
      document.getElementById('duyuruSuccess').style.display = 'block';
      setTimeout(() => {
        document.getElementById('duyuruSuccess').style.display = 'none';
        document.getElementById('duyuru-baslik').value = '';
        document.getElementById('duyuru-icerik').value = '';
      }, 3000);
    } else {
      alert('Webhook hatasÄ±: ' + res.status);
    }
  } catch (err) {
    alert('GÃ¶nderme hatasÄ±: ' + err.message);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// KALAN FONKSÄ°YONLAR (deÄŸiÅŸmedi)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderArsiv() {
  const grid = document.getElementById('arsiv-grid');
  if (!grid) return;
  grid.innerHTML = '';
  arsivKategoriler.forEach(kat => {
    const div = document.createElement('div');
    div.className = 'kutu';
    div.innerHTML = `
      <h3>${kat.baslik}</h3>
      <p>${kat.aciklama}</p>
      <p style="margin-top:1rem; font-weight:bold;">${kat.icerik.length} kayÄ±t</p>
    `;
    div.onclick = () => arsivKategoriAc(kat);
    grid.appendChild(div);
  });
  updateYonetimDropdowns();
}

function arsivKategoriAc(kat) {
  document.getElementById('arsiv-grid').style.display = 'none';
  const detay = document.getElementById('arsiv-detay');
  detay.style.display = 'block';
  let html = `
    <button class="primary" onclick="arsivGeriDon()">Geri DÃ¶n</button>
    <h2>${kat.baslik}</h2>
    <p>${kat.aciklama}</p>
    <h3>KayÄ±tlar:</h3>
  `;
  if (kat.icerik.length === 0) {
    html += '<p>HenÃ¼z kayÄ±t yok.</p>';
  } else {
    kat.icerik.forEach(item => {
      html += `<div class="alt-kutu"><strong>${item.baslik}</strong> <small>(${item.tarih})</small><br>${item.detay}</div>`;
    });
  }
  detay.innerHTML = html;
}

function arsivGeriDon() {
  document.getElementById('arsiv-grid').style.display = 'grid';
  document.getElementById('arsiv-detay').style.display = 'none';
}

function showSection(id) {
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`button[onclick="showSection('${id}')"]`)?.classList.add('active');
  if (id === 'mit-arsivi') renderArsiv();
}

function cikisYap() {
  if (!confirm('Ã‡Ä±kÄ±ÅŸ yapmak istiyor musunuz?')) return;
  currentUser = null;
  isAdmin = false;
  document.getElementById('admin-yonetim-btn').style.display = 'none';
  document.getElementById('panel').style.display = 'none';
  document.getElementById('giris').style.display = 'block';
  document.body.classList.remove('panel-active');
  document.getElementById('access-password').value = '';
}

function sablonDoldur(tip) {
  const area = document.getElementById('report-text');
  const date = new Date().toLocaleDateString('tr-TR');
  let text = `Tarih: ${date}\nGÃ¶nderen: ${currentUser?.kodadi || 'Bilinmeyen'}\n\n`;
  if (tip === 'kisi') text += 'KÄ°ÅžÄ° TAKÄ°P RAPORU\nHedef: \nKonum: \nGÃ¶zlem: ';
  else if (tip === 'operasyon') text += 'OPERASYON RAPORU\nKodu: \nSonuÃ§: \nToplanan veri: ';
  else if (tip === 'acil') text += 'ACÄ°L DURUM RAPORU\nTehdit seviyesi: \nAÃ§Ä±klama: ';
  area.value = text;
}

// Kategori ve alt konu fonksiyonlarÄ± (eksik kÄ±sÄ±mlar iÃ§in placeholder - kendi kodundan tamamla)
function kategoriEkle() { if (!isAdmin) return alert('Yetkisiz!'); alert('Kategori eklendi (kod tamamlanacak)'); }
function kategoriKaldir() { if (!isAdmin) return alert('Yetkisiz!'); alert('Kategori kaldÄ±rÄ±ldÄ± (kod tamamlanacak)'); }
function altKonuEkle() { if (!isAdmin) return alert('Yetkisiz!'); alert('Alt konu eklendi (kod tamamlanacak)'); }
function altKonuKaldir() { if (!isAdmin) return alert('Yetkisiz!'); alert('Alt konu kaldÄ±rÄ±ldÄ± (kod tamamlanacak)'); }
function updateYonetimDropdowns() { /* dropdown gÃ¼ncelleme kodun buraya gelecek */ }
function updateAltKaldirSelect() { /* dropdown gÃ¼ncelleme kodun buraya gelecek */ }

// Saat ve Tema
setInterval(() => {
  document.getElementById('current-time').textContent = new Date().toLocaleTimeString('tr-TR', {hour12:false});
}, 1000);
document.getElementById('theme-toggle-btn').onclick = () => {
  document.body.classList.toggle('dark');
  const icon = document.querySelector('#theme-toggle-btn i');
  icon.classList.toggle('fa-moon');
  icon.classList.toggle('fa-sun');
};

// Sayfa yÃ¼klendiÄŸinde
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('giris-buton').addEventListener('click', girisYap);
  document.getElementById('access-password').addEventListener('keypress', e => {
    if (e.key === 'Enter') girisYap();
  });
  document.getElementById('access-password').focus();
  // updateYonetimDropdowns(); // EÄŸer dropdown varsa burayÄ± aktif et
});
// Kategori dropdown'larÄ±nÄ± gÃ¼ncelleyen ana fonksiyon
function updateYonetimDropdowns() {
  const kaldirSelect = document.getElementById('kaldir-kategori');
  const altEkleSelect = document.getElementById('alt-ekle-kategori');
  const altKaldirSelect = document.getElementById('alt-kaldir-kategori');

  // Ã–nce temizle
  [kaldirSelect, altEkleSelect, altKaldirSelect].forEach(select => {
    if (select) select.innerHTML = '<option value="">Kategori SeÃ§</option>';
  });

  // Kategorileri doldur
  arsivKategoriler.forEach(kat => {
    const option = document.createElement('option');
    option.value = kat.id;
    option.textContent = kat.baslik;

    // ÃœÃ§ select'e de aynÄ± seÃ§enekleri ekle
    if (kaldirSelect) kaldirSelect.appendChild(option.cloneNode(true));
    if (altEkleSelect) altEkleSelect.appendChild(option.cloneNode(true));
    if (altKaldirSelect) altKaldirSelect.appendChild(option.cloneNode(true));
  });
}

// Alt konu kaldÄ±rma iÃ§in seÃ§ilen kategoriye gÃ¶re alt konularÄ± yÃ¼kle
function updateAltKaldirSelect() {
  const kategoriSelect = document.getElementById('alt-kaldir-kategori');
  const itemSelect = document.getElementById('alt-kaldir-item');

  if (!kategoriSelect || !itemSelect) return;

  const selectedId = kategoriSelect.value;
  itemSelect.innerHTML = '<option value="">Alt Konu SeÃ§</option>';

  if (!selectedId) return;

  const kategori = arsivKategoriler.find(k => k.id === selectedId);
  if (kategori && kategori.icerik) {
    kategori.icerik.forEach((item, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.textContent = item.baslik;
      itemSelect.appendChild(option);
    });
  }
}

// Kategori Ekleme (localStorage'a kaydedip dropdown'larÄ± gÃ¼ncelle)
function kategoriEkle() {
  if (!isAdmin) return alert('Yetkisiz!');
  
  const baslik = document.getElementById('kategori-baslik').value.trim();
  const aciklama = document.getElementById('kategori-aciklama').value.trim();
  
  if (!baslik) return alert('Kategori adÄ± zorunlu!');
  
  const yeniId = Date.now().toString(); // basit unique id
  arsivKategoriler.push({
    id: yeniId,
    baslik: baslik,
    aciklama: aciklama,
    icerik: []
  });
  
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arsivKategoriler));
  renderArsiv(); // Ana arÅŸiv grid'ini gÃ¼ncelle
  updateYonetimDropdowns(); // Dropdown'larÄ± gÃ¼ncelle
  
  document.getElementById('kategori-baslik').value = '';
  document.getElementById('kategori-aciklama').value = '';
  document.getElementById('kategoriSuccess').style.display = 'block';
  setTimeout(() => document.getElementById('kategoriSuccess').style.display = 'none', 3000);
}

// Kategori KaldÄ±rma
function kategoriKaldir() {
  if (!isAdmin) return alert('Yetkisiz!');
  
  const select = document.getElementById('kaldir-kategori');
  const selectedId = select.value;
  
  if (!selectedId) return alert('Kategori seÃ§mediniz!');
  
  if (!confirm('Bu kategori ve iÃ§indeki tÃ¼m kayÄ±tlar silinecek. Emin misiniz?')) return;
  
  arsivKategoriler = arsivKategoriler.filter(k => k.id !== selectedId);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arsivKategoriler));
  
  renderArsiv();
  updateYonetimDropdowns();
  
  document.getElementById('kaldirSuccess').style.display = 'block';
  setTimeout(() => document.getElementById('kaldirSuccess').style.display = 'none', 3000);
}

// Alt Konu Ekleme
function altKonuEkle() {
  if (!isAdmin) return alert('Yetkisiz!');
  
  const kategoriId = document.getElementById('alt-ekle-kategori').value;
  const baslik = document.getElementById('alt-baslik').value.trim();
  const detay = document.getElementById('alt-detay').value.trim();
  const tarih = document.getElementById('alt-tarih').value.trim() || new Date().toLocaleDateString('tr-TR');
  
  if (!kategoriId || !baslik || !detay) return alert('Kategori, baÅŸlÄ±k ve detay zorunlu!');
  
  const kategori = arsivKategoriler.find(k => k.id === kategoriId);
  if (kategori) {
    kategori.icerik.push({ baslik, detay, tarih });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arsivKategoriler));
    
    renderArsiv();
    updateYonetimDropdowns();
    
    document.getElementById('altSuccess').style.display = 'block';
    setTimeout(() => document.getElementById('altSuccess').style.display = 'none', 3000);
    
    // Formu temizle
    document.getElementById('alt-baslik').value = '';
    document.getElementById('alt-detay').value = '';
  }
}

// Alt Konu KaldÄ±rma
function altKonuKaldir() {
  if (!isAdmin) return alert('Yetkisiz!');
  
  const kategoriId = document.getElementById('alt-kaldir-kategori').value;
  const itemIndex = document.getElementById('alt-kaldir-item').value;
  
  if (!kategoriId || itemIndex === '') return alert('Kategori ve alt konu seÃ§mediniz!');
  
  const kategori = arsivKategoriler.find(k => k.id === kategoriId);
  if (kategori && kategori.icerik[itemIndex]) {
    if (!confirm('Bu alt konuyu kaldÄ±rmak istiyor musunuz?')) return;
    
    kategori.icerik.splice(itemIndex, 1);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arsivKategoriler));
    
    renderArsiv();
    updateYonetimDropdowns();
    updateAltKaldirSelect();
    
    document.getElementById('altKaldirSuccess').style.display = 'block';
    setTimeout(() => document.getElementById('altKaldirSuccess').style.display = 'none', 3000);
  }
}
</script>
</body>
</html>
